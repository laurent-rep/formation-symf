{% extends 'base.html.twig' %}

{% block title %}Création d'un annonce{% endblock %}

{% form_theme form 'partials/_collection.html.twig' %}

{% block body %}
    <div class="container">
        <h1>Créer une nouvelle annonce</h1>

        {# {{ form(form) }} #}

        {{ form_start(form) }}

        {{ form_widget(form) }}

        <button type="submit" class="btn btn-primary">Créer la nouvelle annonce</button>

        {{ form_end(form) }}
    </div>
{% endblock %}

{% block _annonce_images_widget %}
    <p>Ajoutez vos images !</p>

    {{ form_widget(form) }}

    <input type="hidden" id="widgets-counter" value="0"> {# Pour corriger le bug des doubles suppression#}

    <div class="form-group">
        <button type="button" id="add-image" class="btn btn-primary">Ajouter une image</button>
    </div>

{% endblock %}



{% block javascripts %}
    <script>

        $('#add-image').click(function () {
            const index = +$('#widgets-counter').val(); {# On récupère le n° des champs qu'on veut créer #}

            {# On récupère le code prototype des entrées#}
            const tmpl = $('#annonce_images').data('prototype').replace(/_name_/g, index);

            $('#widgets-counter').val(index + 1);

            {# On injecte le blog dans la div #}

            $('#annonce_images').append(tmpl);

            handleDeleteButtons();

        });
        function handleDeleteButtons() {
            $('button[data-action="delete"]').click(function() {
                const target = this.dataset.target;
                $(target).remove();
            });

        }
    </script>
{% endblock %}
